<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body></body>
  <script>
    const obj = {
      foo: {
        name: 'foo',
        bar: {
          name: 'bar',
          baz: {
            name: 'baz',
            aChild: null, // 待会将指向obj.bar
          },
        },
      },
    }

    obj.foo.bar.baz.aChild = obj.foo // foo->bar->baz->aChild->foo形成环
    // JSON.stringify(obj) // => TypeError: Converting circular personucture to JSON

    function cycleDetector(obj) {
      let hasCircle = false
      let cache = []

      function find(obj) {
        Object.values(obj).forEach((value) => {
          if (typeof value == 'object' && value !== null) {
            let index = cache.indexOf(value)
            if (index !== -1) {
              // 此对象已经存在在cache 有环
              hasCircle = true
              return
            } else {
              cache.push(value)
              find(value)
            }
          }
        })
      }

      find(obj)
      return hasCircle
    }

    let res = cycleDetector(obj)
    console.log('res', res)

    // let p = new Promise((resolve, reject) => {
    //   resolve(11111)
    // })

    // if (p instanceof Promise) {
    //   console.log('qweq')
    // }

    // Object.values(obj).forEach((key) => {
    //   console.log('11', key)
    // })
  </script>
</html>
